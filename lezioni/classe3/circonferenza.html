<!doctype html>
<html lang="it" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>L'Equazione della Circonferenza</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&amp;family=Source+Sans+3:wght@300;400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
  <style>
html { height: 100%; }
body { height: 100%; margin: 0; }

:root {
  --bg-color: #0f172a;
  --surface-color: #1e293b;
  --text-color: #e2e8f0;
  --primary-color: #f59e0b;
  --secondary-color: #6366f1;
  --font-family: 'Playfair Display', Georgia, serif;
  --font-size: 16;
}

* { box-sizing: border-box; }

body {
  font-family: 'Source Sans 3', sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  overflow-x: hidden;
}

.heading-font {
  font-family: var(--font-family), Georgia, serif;
}

.mono {
  font-family: 'JetBrains Mono', monospace;
}

/* Animated background */
.hero-bg {
  position: relative;
  overflow: hidden;
}
.hero-bg::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(ellipse at 30% 50%, rgba(99,102,241,0.15) 0%, transparent 50%),
              radial-gradient(ellipse at 70% 50%, rgba(245,158,11,0.1) 0%, transparent 50%);
  animation: floatBg 20s ease-in-out infinite;
  z-index: 0;
}
@keyframes floatBg {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(2%, -2%) rotate(1deg); }
  66% { transform: translate(-1%, 1%) rotate(-1deg); }
}

/* Section reveal */
.section-reveal {
  opacity: 0;
  transform: translateY(40px);
  transition: opacity 0.8s ease, transform 0.8s ease;
}
.section-reveal.visible {
  opacity: 1;
  transform: translateY(0);
}

/* Math formula styling */
.formula-box {
  background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(245,158,11,0.1));
  border: 1px solid rgba(99,102,241,0.3);
  border-radius: 16px;
  padding: 24px 32px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.formula-box::after {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  animation: shimmer 3s ease-in-out infinite;
}
@keyframes shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* Step animation */
.step-item {
  opacity: 0;
  transform: translateX(-20px);
  transition: all 0.5s ease;
}
.step-item.show {
  opacity: 1;
  transform: translateX(0);
}

/* Canvas grid */
.grid-canvas {
  background: var(--surface-color);
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.1);
  cursor: crosshair;
}

/* Quiz styles */
.quiz-option {
  background: var(--surface-color);
  border: 2px solid rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 14px 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
}
.quiz-option:hover {
  border-color: var(--secondary-color);
  background: rgba(99,102,241,0.1);
}
.quiz-option.correct {
  border-color: #10b981;
  background: rgba(16,185,129,0.15);
}
.quiz-option.wrong {
  border-color: #ef4444;
  background: rgba(239,68,68,0.1);
}
.quiz-option.disabled {
  pointer-events: none;
  opacity: 0.6;
}

/* Smooth scrolling nav */
.nav-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  transition: all 0.3s ease;
  cursor: pointer;
}
.nav-dot.active {
  background: var(--primary-color);
  transform: scale(1.3);
}

/* Concept map */
.concept-node {
  border-radius: 12px;
  padding: 12px 18px;
  text-align: center;
  font-weight: 600;
  transition: transform 0.3s ease;
}
.concept-node:hover {
  transform: scale(1.05);
}

/* Slider styling */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  border-radius: 3px;
  background: rgba(255,255,255,0.15);
  outline: none;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: var(--primary-color);
  cursor: pointer;
  border: 2px solid white;
}

/* Tab styles */
.tab-btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.3s ease;
  cursor: pointer;
  background: transparent;
  color: var(--text-color);
  border: none;
  font-size: inherit;
}
.tab-btn.active {
  background: var(--secondary-color);
  color: white;
}

/* Real life example cards */
.example-card {
  background: var(--surface-color);
  border-radius: 16px;
  padding: 24px;
  border: 1px solid rgba(255,255,255,0.08);
  transition: transform 0.3s ease, border-color 0.3s ease;
}
.example-card:hover {
  transform: translateY(-4px);
  border-color: var(--primary-color);
}

/* Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-color); }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
</style>
  <style>body { box-sizing: border-box; }

/* ===== RESPONSIVE ===== */

/* Fluid type â€” only font-size on elements, NOT on html to preserve height:100% chain */
@media (max-width: 480px) {
  body { font-size: 15px; }
  h1.heading-font, h1 { font-size: clamp(1.8rem, 9vw, 3.5rem) !important; line-height: 1.15 !important; }
  h2.heading-font, h2 { font-size: clamp(1.5rem, 7vw, 2.5rem) !important; }
  section { padding-left: 1rem !important; padding-right: 1rem !important; }
  .formula-box { padding: 14px 16px; }
  /* prevent iOS zoom on focus */
  input, select, textarea { font-size: 16px !important; }
}

/* Touch target sizes */
@media (pointer: coarse) {
  button, .tab-btn { min-height: 44px; }
  .quiz-option { min-height: 48px; padding: 14px 16px; }
  input[type="range"] { height: 10px; }
  input[type="range"]::-webkit-slider-thumb { width: 28px; height: 28px; }
  /* remove hover-only effects that get "stuck" on touch */
  .example-card:hover { transform: none; border-color: rgba(255,255,255,0.08); }
  .concept-node:hover { transform: none; }
}

/* Canvas: fill container width, keep square */
#interactiveCanvas {
  width: 100% !important;
  max-width: 500px;
  height: auto;
  display: block;
  touch-action: none;
}

/* Responsive point-check form */
@media (max-width: 540px) {
  #checkX, #checkY { width: 70px !important; }
}

/* Scrollbar thinner on mobile */
@media (max-width: 640px) {
  ::-webkit-scrollbar { width: 4px; }
}

/* SVG never overflow */
svg { max-width: 100%; height: auto; }

/* Focus visible */
button:focus-visible, input:focus-visible, .quiz-option:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}
</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <!-- Fullscreen button -->
  <button id="fsBtn" onclick="toggleFullscreen()" title="Schermo intero" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    background: rgba(30,41,59,0.92);
    color: #e2e8f0;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    transition: background 0.2s, transform 0.15s;
    backdrop-filter: blur(6px);
  " onmouseenter="this.style.background='rgba(99,102,241,0.85)'" onmouseleave="this.style.background='rgba(30,41,59,0.92)'">
    <svg id="fsIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/>
      <line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
    </svg>
  </button>
  <script>
  function toggleFullscreen() {
    var el = document.documentElement;
    var btn = document.getElementById('fsBtn');
    if (!document.fullscreenElement && !document.webkitFullscreenElement) {
      var req = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
      if (req) req.call(el);
    } else {
      var ex = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
      if (ex) ex.call(document);
    }
  }
  // Swap icon when fullscreen changes
  document.addEventListener('fullscreenchange', updateFsIcon);
  document.addEventListener('webkitfullscreenchange', updateFsIcon);
  function updateFsIcon() {
    var icon = document.getElementById('fsIcon');
    if (document.fullscreenElement || document.webkitFullscreenElement) {
      icon.innerHTML = '<polyline points="9 3 3 3 3 9"/><polyline points="15 21 21 21 21 15"/><line x1="3" y1="3" x2="10" y2="10"/><line x1="21" y1="21" x2="14" y2="14"/>';
    } else {
      icon.innerHTML = '<polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>';
    }
  }
  </script>
  <main class="w-full" id="mainWrapper" style="overflow-y:auto; height:100%;"><!-- ===== SEZIONE 1: INTRODUZIONE ===== -->
   <section id="sec-intro" class="hero-bg min-h-screen flex items-center justify-center relative" style="min-height:100%;">
    <div class="relative z-10 max-w-4xl mx-auto px-6 py-20 text-center">
     <div class="section-reveal" data-delay="0">
      <p class="text-sm uppercase tracking-[0.3em] mb-4" style="color: var(--primary-color);">Geometria Analitica</p>
      <h1 class="heading-font text-5xl md:text-7xl font-extrabold mb-6 leading-tight" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">L'Equazione della Circonferenza</h1>
      <p class="text-xl md:text-2xl font-light opacity-80 mb-12">Un viaggio nella geometria analitica</p>
     </div>
     <div class="section-reveal" data-delay="300">
      <div class="inline-block mb-12">
       <svg width="200" height="200" viewbox="0 0 200 200" class="mx-auto"><defs>
         <lineargradient id="circGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#6366f1" />
          <stop offset="100%" style="stop-color:#f59e0b" />
         </lineargradient>
        </defs> <circle cx="100" cy="100" r="70" fill="none" stroke="url(#circGrad)" stroke-width="3" stroke-dasharray="440" stroke-dashoffset="440">
         <animate attributename="stroke-dashoffset" to="0" dur="2s" fill="freeze" begin="0.5s" />
        </circle> <circle cx="100" cy="100" r="4" fill="var(--primary-color)">
         <animate attributename="opacity" values="0;1" dur="0.3s" fill="freeze" begin="2.5s" />
        </circle> <line x1="100" y1="100" x2="170" y2="100" stroke="var(--primary-color)" stroke-width="2" stroke-dasharray="1 4" opacity="0">
         <animate attributename="opacity" values="0;1" dur="0.5s" fill="freeze" begin="2.8s" />
        </line> <text x="135" y="94" fill="var(--primary-color)" font-size="14" font-family="JetBrains Mono" opacity="0">
         r 
         <animate attributename="opacity" values="0;1" dur="0.5s" fill="freeze" begin="3s" />
        </text> <text x="100" y="120" fill="var(--text-color)" font-size="12" text-anchor="middle" font-family="JetBrains Mono" opacity="0">
         C(a,b) 
         <animate attributename="opacity" values="0;1" dur="0.5s" fill="freeze" begin="3.2s" />
        </text>
       </svg>
      </div>
     </div>
     <div class="section-reveal" data-delay="600">
      <div class="formula-box inline-block">
       <p class="text-lg mb-2 opacity-70">Definizione</p>
       <p class="text-xl md:text-2xl">La <strong style="color:var(--primary-color)">circonferenza</strong> Ã¨ il <em>luogo geometrico</em> dei punti del piano equidistanti da un punto fisso detto <strong style="color:var(--secondary-color)">centro</strong>.</p>
      </div>
     </div><!-- Esempi vita reale -->
     <div class="section-reveal mt-16" data-delay="900">
      <h2 class="heading-font text-2xl font-bold mb-8">Circonferenze nella vita reale</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
       <div class="example-card">
        <div class="text-5xl mb-4">
         ğŸ¯
        </div>
        <h3 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Bersaglio</h3>
        <p class="text-sm opacity-70">I cerchi concentrici di un bersaglio sono circonferenze con lo stesso centro ma raggi diversi.</p>
       </div>
       <div class="example-card">
        <div class="text-5xl mb-4">
         ğŸ¡
        </div>
        <h3 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Ruota panoramica</h3>
        <p class="text-sm opacity-70">Il percorso circolare Ã¨ una circonferenza perfetta: il centro Ã¨ il mozzo, il raggio Ã¨ la lunghezza del braccio.</p>
       </div>
       <div class="example-card">
        <div class="text-5xl mb-4">
         ğŸ•
        </div>
        <h3 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Orologio</h3>
        <p class="text-sm opacity-70">Il bordo del quadrante e il percorso delle lancette descrivono circonferenze con centro al centro dell'orologio.</p>
       </div>
      </div>
     </div>
     <div class="section-reveal mt-12" data-delay="1100"><button onclick="scrollToSection('sec-richiami')" class="inline-flex items-center gap-2 px-8 py-4 rounded-full font-semibold text-lg transition-all hover:scale-105" style="background:var(--secondary-color); color:white;"> Iniziamo il viaggio â†“ </button>
     </div>
    </div>
   </section><!-- ===== SEZIONE 2: RICHIAMI TEORICI ===== -->
   <section id="sec-richiami" class="py-24 px-6">
    <div class="max-w-4xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 2</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-12">Richiami Teorici</h2>
     </div><!-- Piano cartesiano -->
     <div class="section-reveal" data-delay="200">
      <div class="formula-box mb-10">
       <h3 class="heading-font text-2xl font-bold mb-4">Il Piano Cartesiano</h3>
       <p class="opacity-80 mb-6">Due rette perpendicolari (assi <strong>x</strong> e <strong>y</strong>) dividono il piano in 4 quadranti. Ogni punto Ã¨ identificato da una coppia <span class="mono">(x, y)</span>.</p>
       <svg width="280" height="280" viewbox="0 0 280 280" class="mx-auto"><!-- Grid --> <g stroke="rgba(255,255,255,0.06)" stroke-width="1">
         <line x1="40" y1="20" x2="40" y2="260" />
         <line x1="80" y1="20" x2="80" y2="260" />
         <line x1="120" y1="20" x2="120" y2="260" />
         <line x1="160" y1="20" x2="160" y2="260" />
         <line x1="200" y1="20" x2="200" y2="260" />
         <line x1="240" y1="20" x2="240" y2="260" />
         <line x1="20" y1="40" x2="260" y2="40" />
         <line x1="20" y1="80" x2="260" y2="80" />
         <line x1="20" y1="120" x2="260" y2="120" />
         <line x1="20" y1="160" x2="260" y2="160" />
         <line x1="20" y1="200" x2="260" y2="200" />
         <line x1="20" y1="240" x2="260" y2="240" />
        </g> <!-- Axes --> <line x1="140" y1="15" x2="140" y2="265" stroke="var(--text-color)" stroke-width="2" /> <line x1="15" y1="140" x2="265" y2="140" stroke="var(--text-color)" stroke-width="2" /> <!-- Arrows --> <polygon points="140,15 135,25 145,25" fill="var(--text-color)" /> <polygon points="265,140 255,135 255,145" fill="var(--text-color)" /> <text x="250" y="158" fill="var(--text-color)" font-size="14" font-weight="bold">
         x
        </text> <text x="148" y="28" fill="var(--text-color)" font-size="14" font-weight="bold">
         y
        </text> <!-- Point P --> <circle cx="200" cy="80" r="5" fill="var(--primary-color)" /> <line x1="200" y1="80" x2="200" y2="140" stroke="var(--primary-color)" stroke-width="1" stroke-dasharray="4 4" /> <line x1="140" y1="80" x2="200" y2="80" stroke="var(--primary-color)" stroke-width="1" stroke-dasharray="4 4" /> <text x="205" y="75" fill="var(--primary-color)" font-size="13" font-family="JetBrains Mono">
         P(x,y)
        </text> <!-- Quadrant labels --> <text x="165" y="70" fill="rgba(255,255,255,0.2)" font-size="11">
         I
        </text> <text x="100" y="70" fill="rgba(255,255,255,0.2)" font-size="11">
         II
        </text> <text x="100" y="170" fill="rgba(255,255,255,0.2)" font-size="11">
         III
        </text> <text x="165" y="170" fill="rgba(255,255,255,0.2)" font-size="11">
         IV
        </text> <text x="133" y="158" fill="var(--text-color)" font-size="12">
         O
        </text>
       </svg>
      </div>
     </div><!-- Distanza tra due punti -->
     <div class="section-reveal" data-delay="400">
      <div class="formula-box mb-10">
       <h3 class="heading-font text-2xl font-bold mb-4">Distanza tra due punti</h3>
       <p class="opacity-80 mb-4">Dati due punti <span class="mono">A(xâ‚, yâ‚)</span> e <span class="mono">B(xâ‚‚, yâ‚‚)</span>, la loro distanza si calcola con il <strong>Teorema di Pitagora</strong>:</p>
       <svg width="300" height="200" viewbox="0 0 300 200" class="mx-auto mb-4"><!-- Triangle --> <line x1="50" y1="150" x2="250" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="1" stroke-dasharray="4 4" /> <line x1="250" y1="150" x2="250" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="1" stroke-dasharray="4 4" /> <line x1="50" y1="150" x2="250" y2="50" stroke="var(--secondary-color)" stroke-width="3" /> <!-- Points --> <circle cx="50" cy="150" r="5" fill="var(--primary-color)" /> <circle cx="250" cy="50" r="5" fill="var(--primary-color)" /> <!-- Labels --> <text x="20" y="148" fill="var(--primary-color)" font-size="13" font-family="JetBrains Mono">
         A(xâ‚,yâ‚)
        </text> <text x="218" y="42" fill="var(--primary-color)" font-size="13" font-family="JetBrains Mono">
         B(xâ‚‚,yâ‚‚)
        </text> <text x="130" y="170" fill="rgba(255,255,255,0.5)" font-size="12">
         xâ‚‚ âˆ’ xâ‚
        </text> <text x="255" y="105" fill="rgba(255,255,255,0.5)" font-size="12">
         yâ‚‚ âˆ’ yâ‚
        </text> <text x="115" y="90" fill="var(--secondary-color)" font-size="14" font-weight="bold">
         d
        </text> <!-- Right angle --> <polyline points="238,150 238,138 250,138" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1" />
       </svg>
       <div class="mono text-2xl md:text-3xl font-bold" style="color:var(--secondary-color);">
        d = <math><msqrt><mn>(xâ‚‚âˆ’xâ‚)Â² + (yâ‚‚âˆ’yâ‚)Â²</mn></msqrt></math>
       </div>
      </div>
     </div>
     <div class="section-reveal text-center mt-8" data-delay="500"><button onclick="scrollToSection('sec-equazione')" class="inline-flex items-center gap-2 px-6 py-3 rounded-full font-semibold transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;"> Ora deriviamo l'equazione â†’ </button>
     </div>
    </div>
   </section><!-- ===== SEZIONE 3: EQUAZIONE DELLA CIRCONFERENZA ===== -->
   <section id="sec-equazione" class="py-24 px-6" style="background: linear-gradient(180deg, transparent, rgba(99,102,241,0.05));">
    <div class="max-w-4xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 3</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-6">Derivazione dell'Equazione</h2>
      <p class="opacity-70 text-lg mb-10">Costruiamo l'equazione passo dopo passo.</p>
     </div><!-- Derivazione guidata -->
     <div id="derivationSteps" class="space-y-6">
      <div class="step-item" data-step="0">
       <div class="formula-box text-left">
        <div class="flex items-start gap-4"><span class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg" style="background:var(--secondary-color); color:white;">1</span>
         <div>
          <h4 class="font-bold text-lg mb-2">Partiamo dalla definizione</h4>
          <p class="opacity-80">Sia <span class="mono" style="color:var(--primary-color)">C(a, b)</span> il centro e <span class="mono" style="color:var(--primary-color)">r</span> il raggio. Un punto <span class="mono">P(x, y)</span> sta sulla circonferenza se e solo se la sua distanza dal centro Ã¨ uguale al raggio:</p>
          <p class="mono text-xl mt-3 text-center" style="color:var(--secondary-color)">d(P, C) = r</p>
         </div>
        </div>
       </div>
      </div>
      <div class="step-item" data-step="1">
       <div class="formula-box text-left">
        <div class="flex items-start gap-4"><span class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg" style="background:var(--secondary-color); color:white;">2</span>
         <div>
          <h4 class="font-bold text-lg mb-2">Applichiamo la formula della distanza</h4>
          <p class="opacity-80">Sostituiamo nella formula della distanza tra P(x,y) e C(a,b):</p>
          <p class="mono text-xl mt-3 text-center" style="color:var(--secondary-color)"><math><msqrt><mn>(xâˆ’a)Â² + (yâˆ’b)Â²</mn></msqrt></math> = r</p>
         </div>
        </div>
       </div>
      </div>
      <div class="step-item" data-step="2">
       <div class="formula-box text-left">
        <div class="flex items-start gap-4"><span class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg" style="background:var(--secondary-color); color:white;">3</span>
         <div>
          <h4 class="font-bold text-lg mb-2">Eleviamo al quadrato</h4>
          <p class="opacity-80">Per eliminare la radice, eleviamo entrambi i membri al quadrato:</p>
          <p class="mono text-2xl mt-3 text-center font-bold" style="color:var(--primary-color)">(x âˆ’ a)Â² + (y âˆ’ b)Â² = rÂ²</p>
          <p class="mt-3 text-center font-semibold" style="color:var(--primary-color)">âœ¨ Ecco l'equazione della circonferenza!</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Reveal button -->
     <div class="text-center mt-8 section-reveal" data-delay="200"><button id="revealStepsBtn" onclick="revealNextStep()" class="px-6 py-3 rounded-full font-semibold transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;"> Mostra passo successivo â†’ </button>
     </div><!-- Significato dei parametri -->
     <div class="section-reveal mt-16" data-delay="400">
      <h3 class="heading-font text-2xl font-bold mb-6">Significato dei parametri</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
       <div class="formula-box">
        <div class="text-3xl mb-3">
         ğŸ“
        </div>
        <h4 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Centro C(a, b)</h4>
        <p class="text-sm opacity-70"><span class="mono">a</span> = ascissa del centro<br><span class="mono">b</span> = ordinata del centro</p>
       </div>
       <div class="formula-box">
        <div class="text-3xl mb-3">
         ğŸ“
        </div>
        <h4 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Raggio r</h4>
        <p class="text-sm opacity-70">La distanza costante tra il centro e qualsiasi punto della circonferenza. Deve essere <span class="mono">r &gt; 0</span>.</p>
       </div>
       <div class="formula-box">
        <div class="text-3xl mb-3">
         ğŸ”„
        </div>
        <h4 class="font-bold text-lg mb-2" style="color:var(--primary-color);">Punto P(x, y)</h4>
        <p class="text-sm opacity-70">Un generico punto che soddisfa l'equazione: si muove lungo la circonferenza.</p>
       </div>
      </div>
     </div>
    </div>
   </section><!-- ===== SEZIONE 4: CASI PARTICOLARI ===== -->
   <section id="sec-casi" class="py-24 px-6">
    <div class="max-w-4xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 4</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-12">Casi Particolari</h2>
     </div><!-- Centro nell'origine -->
     <div class="section-reveal" data-delay="200">
      <div class="formula-box mb-10">
       <h3 class="heading-font text-2xl font-bold mb-4">Centro nell'origine O(0,0)</h3>
       <p class="opacity-80 mb-4">Se il centro coincide con l'origine, <span class="mono">a = 0</span> e <span class="mono">b = 0</span>:</p>
       <p class="mono text-xl mb-2" style="color:var(--text-color)">(x âˆ’ 0)Â² + (y âˆ’ 0)Â² = rÂ²</p>
       <p class="mono text-2xl font-bold" style="color:var(--primary-color)">xÂ² + yÂ² = rÂ²</p>
       <p class="mt-3 text-sm opacity-60">La forma piÃ¹ semplice dell'equazione della circonferenza!</p>
      </div>
     </div><!-- Equazione generale -->
     <div class="section-reveal" data-delay="400">
      <div class="formula-box mb-10">
       <h3 class="heading-font text-2xl font-bold mb-4">Forma generale (sviluppata)</h3>
       <p class="opacity-80 mb-4">Espandendo l'equazione canonica:</p>
       <div class="space-y-2 mb-4">
        <p class="mono text-lg">(x âˆ’ a)Â² + (y âˆ’ b)Â² = rÂ²</p>
        <p class="mono text-lg">xÂ² âˆ’ 2ax + aÂ² + yÂ² âˆ’ 2by + bÂ² = rÂ²</p>
        <p class="mono text-lg font-bold" style="color:var(--primary-color)">xÂ² + yÂ² âˆ’ 2ax âˆ’ 2by + aÂ² + bÂ² âˆ’ rÂ² = 0</p>
       </div>
       <p class="opacity-80 mb-2">Ponendo <span class="mono">Î± = âˆ’2a</span>, <span class="mono">Î² = âˆ’2b</span>, <span class="mono">Î³ = aÂ² + bÂ² âˆ’ rÂ²</span>:</p>
       <p class="mono text-2xl font-bold" style="color:var(--secondary-color)">xÂ² + yÂ² + Î±x + Î²y + Î³ = 0</p>
      </div>
     </div><!-- Come trovare centro e raggio -->
     <div class="section-reveal" data-delay="600">
      <div class="formula-box">
       <h3 class="heading-font text-2xl font-bold mb-4">ğŸ“ Da forma generale a centro e raggio</h3>
       <p class="opacity-80 mb-4">Data l'equazione <span class="mono">xÂ² + yÂ² + Î±x + Î²y + Î³ = 0</span>:</p>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
        <div class="p-4 rounded-lg" style="background:rgba(99,102,241,0.1)">
         <p class="font-bold mb-2" style="color:var(--secondary-color);">Centro:</p>
         <p class="mono text-lg">a = âˆ’Î±/2</p>
         <p class="mono text-lg">b = âˆ’Î²/2</p>
         <p class="mono text-lg mt-1 font-bold" style="color:var(--primary-color)">C(âˆ’Î±/2, âˆ’Î²/2)</p>
        </div>
        <div class="p-4 rounded-lg" style="background:rgba(245,158,11,0.1)">
         <p class="font-bold mb-2" style="color:var(--primary-color);">Raggio:</p>
         <p class="mono text-lg">r = <math><msqrt><mn>(aÂ² + bÂ² âˆ’ Î³)</mn></msqrt></math></p>
         <p class="mono text-lg mt-1 font-bold" style="color:var(--primary-color);">r = <math><msqrt><mn>(Î±Â²/4 + Î²Â²/4 âˆ’ Î³)</mn></msqrt></math> </p>
         <p class="text-sm mt-2 opacity-60">Condizione: Î±Â²/4 + Î²Â²/4 âˆ’ Î³ &gt; 0</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section><!-- ===== SEZIONE 5: PARTE INTERATTIVA ===== -->
   <section id="sec-interattiva" class="py-24 px-6" style="background: linear-gradient(180deg, transparent, rgba(245,158,11,0.05));">
    <div class="max-w-5xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 5</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-4">Parte Interattiva</h2>
      <p class="text-lg opacity-70 mb-10">Esplora la circonferenza con le tue mani!</p>
     </div><!-- Tabs -->
     <div class="flex flex-wrap gap-3 mb-8 section-reveal" data-delay="200"><button class="tab-btn active" onclick="switchInteractiveTab('graph')">ğŸ¨ Grafico</button> <button class="tab-btn" onclick="switchInteractiveTab('quiz-mini')">â“ Quiz Rapido</button>
     </div><!-- Tab: Graph -->
     <div id="tab-graph" class="section-reveal" data-delay="300">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Canvas -->
       <div>
        <canvas id="interactiveCanvas" class="grid-canvas w-full" width="500" height="500" style="max-width:500px;"></canvas>
        <p class="text-xs opacity-50 mt-2 text-center">Clicca sul piano per posizionare il centro</p>
       </div><!-- Controls -->
       <div class="space-y-6">
        <div><label for="sliderA" class="block font-semibold mb-2">Centro X (a): <span id="valA" class="mono" style="color:var(--primary-color)">0</span></label> <input type="range" id="sliderA" min="-5" max="5" step="0.5" value="0" class="w-full" oninput="updateCircle()">
        </div>
        <div><label for="sliderB" class="block font-semibold mb-2">Centro Y (b): <span id="valB" class="mono" style="color:var(--primary-color)">0</span></label> <input type="range" id="sliderB" min="-5" max="5" step="0.5" value="0" class="w-full" oninput="updateCircle()">
        </div>
        <div><label for="sliderR" class="block font-semibold mb-2">Raggio (r): <span id="valR" class="mono" style="color:var(--primary-color)">3</span></label> <input type="range" id="sliderR" min="0.5" max="5" step="0.5" value="3" class="w-full" oninput="updateCircle()">
        </div>
        <div class="formula-box">
         <p class="text-sm opacity-60 mb-1">Equazione corrente:</p>
         <p id="currentEquation" class="mono text-lg font-bold" style="color:var(--primary-color)">(x âˆ’ 0)Â² + (y âˆ’ 0)Â² = 9</p>
        </div>
        <div class="formula-box">
         <p class="text-sm opacity-60 mb-1">Forma sviluppata:</p>
         <p id="expandedEquation" class="mono text-base" style="color:var(--secondary-color)">xÂ² + yÂ² âˆ’ 9 = 0</p>
        </div><!-- Point check -->
        <div class="formula-box">
         <p class="font-semibold mb-3">Verifica se un punto appartiene:</p>
         <div class="flex gap-3 items-end flex-wrap">
          <div><label for="checkX" class="text-sm opacity-60">x =</label> <input type="number" id="checkX" value="3" step="0.5" class="mono w-20 px-3 py-2 rounded-lg border-none text-center" style="background:rgba(255,255,255,0.1); color:var(--text-color);">
          </div>
          <div><label for="checkY" class="text-sm opacity-60">y =</label> <input type="number" id="checkY" value="0" step="0.5" class="mono w-20 px-3 py-2 rounded-lg border-none text-center" style="background:rgba(255,255,255,0.1); color:var(--text-color);">
          </div><button onclick="checkPoint()" class="px-4 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background:var(--secondary-color); color:white;">Verifica</button>
         </div>
         <p id="pointResult" class="mt-3 text-sm font-semibold"></p>
        </div>
       </div>
      </div>
     </div><!-- Tab: Mini Quiz -->
     <div id="tab-quiz-mini" class="hidden">
      <div id="miniQuizContainer" class="space-y-6"></div>
     </div>
    </div>
   </section><!-- ===== SEZIONE 6: ATTIVITÃ€ GUIDATA ===== -->
   <section id="sec-guidata" class="py-24 px-6">
    <div class="max-w-4xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 6</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-12">AttivitÃ  Guidata</h2>
     </div><!-- Problema 1 -->
     <div class="section-reveal" data-delay="200">
      <div class="formula-box mb-8">
       <div class="flex items-center gap-3 mb-4"><span class="px-3 py-1 rounded-full text-sm font-bold" style="background:var(--secondary-color); color:white;">Problema 1</span>
        <h3 class="font-bold text-lg">Determinare l'equazione</h3>
       </div>
       <p class="opacity-80 mb-4">Scrivi l'equazione della circonferenza con centro <span class="mono" style="color:var(--primary-color)">C(2, âˆ’3)</span> e raggio <span class="mono" style="color:var(--primary-color)">r = 5</span>.</p>
       <div id="prob1Steps" class="text-left space-y-3">
        <div class="p-3 rounded-lg" style="background:rgba(99,102,241,0.1);">
         <p class="font-semibold mb-1" style="color:var(--secondary-color);">Passo 1: Scriviamo la forma canonica</p>
         <p class="mono">(x âˆ’ a)Â² + (y âˆ’ b)Â² = rÂ²</p>
        </div>
       </div><button onclick="revealProblem(1)" id="prob1Btn" class="mt-4 px-5 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;">Mostra passo successivo</button>
      </div>
     </div><!-- Problema 2 -->
     <div class="section-reveal" data-delay="400">
      <div class="formula-box mb-8">
       <div class="flex items-center gap-3 mb-4"><span class="px-3 py-1 rounded-full text-sm font-bold" style="background:var(--secondary-color); color:white;">Problema 2</span>
        <h3 class="font-bold text-lg">Trovare centro e raggio</h3>
       </div>
       <p class="opacity-80 mb-4">Data l'equazione <span class="mono" style="color:var(--primary-color)">xÂ² + yÂ² âˆ’ 6x + 4y âˆ’ 12 = 0</span>, trova centro e raggio.</p>
       <div id="prob2Steps" class="text-left space-y-3">
        <div class="p-3 rounded-lg" style="background:rgba(99,102,241,0.1);">
         <p class="font-semibold mb-1" style="color:var(--secondary-color);">Passo 1: Identifichiamo Î±, Î², Î³</p>
         <p class="mono">Î± = âˆ’6, Î² = 4, Î³ = âˆ’12</p>
        </div>
       </div><button onclick="revealProblem(2)" id="prob2Btn" class="mt-4 px-5 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;">Mostra passo successivo</button>
      </div>
     </div><!-- Problema 3 -->
     <div class="section-reveal" data-delay="600">
      <div class="formula-box">
       <div class="flex items-center gap-3 mb-4"><span class="px-3 py-1 rounded-full text-sm font-bold" style="background:var(--secondary-color); color:white;">Problema 3</span>
        <h3 class="font-bold text-lg">Appartenenza di un punto</h3>
       </div>
       <p class="opacity-80 mb-4">Il punto <span class="mono" style="color:var(--primary-color)">P(1, 2)</span> appartiene alla circonferenza <span class="mono" style="color:var(--primary-color)">xÂ² + yÂ² = 5</span>?</p>
       <div id="prob3Steps" class="text-left space-y-3">
        <div class="p-3 rounded-lg" style="background:rgba(99,102,241,0.1);">
         <p class="font-semibold mb-1" style="color:var(--secondary-color);">Passo 1: Sostituiamo le coordinate di P</p>
         <p class="mono">1Â² + 2Â² = 1 + 4 = 5</p>
        </div>
       </div><button onclick="revealProblem(3)" id="prob3Btn" class="mt-4 px-5 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;">Mostra passo successivo</button>
      </div>
     </div>
    </div>
   </section><!-- ===== SEZIONE 7: VERIFICA FINALE ===== -->
   <section id="sec-verifica" class="py-24 px-6" style="background: linear-gradient(180deg, transparent, rgba(99,102,241,0.05));">
    <div class="max-w-4xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 7</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-4">Verifica Finale</h2>
      <p class="text-lg opacity-70 mb-10">Metti alla prova le tue conoscenze!</p>
     </div>
     <div id="finalQuiz" class="space-y-8 section-reveal" data-delay="200"><!-- Quiz questions will be rendered by JS -->
     </div>
     <div class="text-center mt-10 section-reveal" data-delay="400"><button id="submitQuizBtn" onclick="submitFinalQuiz()" class="px-8 py-4 rounded-full font-bold text-lg transition-all hover:scale-105" style="background:var(--primary-color); color:#0f172a;"> âœ… Verifica Risposte </button>
      <div id="quizResult" class="mt-6 text-xl font-bold hidden"></div>
     </div>
    </div>
   </section><!-- ===== SEZIONE 8: RIEPILOGO ===== -->
   <section id="sec-riepilogo" class="py-24 px-6">
    <div class="max-w-5xl mx-auto">
     <div class="section-reveal">
      <p class="text-sm uppercase tracking-[0.3em] mb-2" style="color:var(--primary-color);">Sezione 8</p>
      <h2 class="heading-font text-4xl md:text-5xl font-bold mb-12">Riepilogo Visivo</h2>
     </div><!-- Concept Map -->
     <div class="section-reveal" data-delay="200">
      <h3 class="heading-font text-2xl font-bold mb-8 text-center">Mappa Concettuale</h3>
      <div class="relative flex flex-col items-center gap-4 mb-16"><!-- Center node -->
       <div class="concept-node text-lg" style="background:var(--secondary-color); color:white; font-size:1.1rem;">
        Equazione della Circonferenza
       </div>
       <svg width="200" height="40" class="mx-auto">
        <line x1="100" y1="0" x2="100" y2="40" stroke="rgba(255,255,255,0.2)" stroke-width="2" />
       </svg><!-- Row 2 -->
       <div class="flex flex-wrap gap-4 justify-center">
        <div class="concept-node" style="background:rgba(245,158,11,0.2); border:1px solid var(--primary-color); color:var(--primary-color);">
         Forma canonica<br><span class="mono text-sm">(xâˆ’a)Â²+(yâˆ’b)Â²=rÂ²</span>
        </div>
        <div class="concept-node" style="background:rgba(99,102,241,0.2); border:1px solid var(--secondary-color); color:var(--secondary-color);">
         Forma generale<br><span class="mono text-sm">xÂ²+yÂ²+Î±x+Î²y+Î³=0</span>
        </div>
       </div>
       <svg width="400" height="40" class="mx-auto">
        <line x1="200" y1="0" x2="100" y2="40" stroke="rgba(255,255,255,0.15)" stroke-width="1.5" /><line x1="200" y1="0" x2="200" y2="40" stroke="rgba(255,255,255,0.15)" stroke-width="1.5" /><line x1="200" y1="0" x2="300" y2="40" stroke="rgba(255,255,255,0.15)" stroke-width="1.5" />
       </svg><!-- Row 3 -->
       <div class="flex flex-wrap gap-4 justify-center">
        <div class="concept-node text-sm" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.15);">
         Centro<br><span class="mono" style="color:var(--primary-color)">C(a, b)</span>
        </div>
        <div class="concept-node text-sm" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.15);">
         Raggio<br><span class="mono" style="color:var(--primary-color)">r &gt; 0</span>
        </div>
        <div class="concept-node text-sm" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.15);">
         Distanza<br><span class="mono" style="color:var(--primary-color)">d(P,C) = r</span>
        </div>
       </div>
      </div>
     </div><!-- Formula Summary -->
     <div class="section-reveal" data-delay="400">
      <h3 class="heading-font text-2xl font-bold mb-8 text-center">Schema Riassuntivo delle Formule</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--primary-color)">ğŸ“Œ Equazione canonica</h4>
        <p class="mono text-lg mb-2">(x âˆ’ a)Â² + (y âˆ’ b)Â² = rÂ²</p>
        <p class="text-sm opacity-60">Centro: C(a, b) â€” Raggio: r</p>
       </div>
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--primary-color)">ğŸ“Œ Centro nell'origine</h4>
        <p class="mono text-lg mb-2">xÂ² + yÂ² = rÂ²</p>
        <p class="text-sm opacity-60">Centro: O(0, 0) â€” Raggio: r</p>
       </div>
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--secondary-color)">ğŸ“Œ Forma generale</h4>
        <p class="mono text-lg mb-2">xÂ² + yÂ² + Î±x + Î²y + Î³ = 0</p>
        <p class="text-sm opacity-60">Î± = âˆ’2a, Î² = âˆ’2b, Î³ = aÂ²+bÂ²âˆ’rÂ²</p>
       </div>
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--secondary-color)">ğŸ“Œ Da generale a canonica</h4>
        <p class="mono text-sm mb-1">Centro: C(âˆ’Î±/2, âˆ’Î²/2)</p>
        <p class="mono text-sm mb-1">Raggio: r = <math><msqrt><mn>Î±Â²/4 + Î²Â²/4 âˆ’ Î³</mn></msqrt></math></p>
        <p class="text-sm opacity-60 mt-2">Condizione: Î±Â²/4 + Î²Â²/4 âˆ’ Î³ &gt; 0</p>
       </div>
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--primary-color)">ğŸ“Œ Distanza tra due punti</h4>
        <p class="mono text-lg mb-2">d = <math><msqrt><mn>(xâ‚‚âˆ’xâ‚)Â² + (yâ‚‚âˆ’yâ‚)Â²</mn></msqrt></math></p>
        <p class="text-sm opacity-60">Base per derivare l'equazione</p>
       </div>
       <div class="formula-box text-left">
        <h4 class="font-bold mb-3" style="color:var(--secondary-color)">ğŸ“Œ Appartenenza di un punto</h4>
        <p class="text-sm mb-1">Sostituisci P(xâ‚€, yâ‚€) nell'equazione:</p>
        <p class="mono text-sm">Se = 0 â†’ <span style="color:#10b981">appartiene</span></p>
        <p class="mono text-sm">Se â‰  0 â†’ <span style="color:#ef4444">non appartiene</span></p>
       </div>
      </div>
     </div><!-- Completion message -->
     <div class="section-reveal mt-16 text-center" data-delay="600">
      <div class="formula-box inline-block">
       <div class="text-5xl mb-4">
        ğŸ“
       </div>
       <h3 class="heading-font text-2xl font-bold mb-2">Complimenti!</h3>
       <p class="opacity-80">Hai completato la lezione sull'equazione della circonferenza.</p>
       <p class="opacity-60 text-sm mt-2">Torna alle sezioni precedenti per ripassare o ripetere gli esercizi.</p>
      </div>
     </div>
    </div>
   </section>
  </main>
  <script>
// ========== SECTIONS & NAVIGATION ==========
const sections = [
  { id: 'sec-intro', label: 'Introduzione' },
  { id: 'sec-richiami', label: 'Richiami' },
  { id: 'sec-equazione', label: 'Equazione' },
  { id: 'sec-casi', label: 'Casi' },
  { id: 'sec-interattiva', label: 'Interattiva' },
  { id: 'sec-guidata', label: 'Guidata' },
  { id: 'sec-verifica', label: 'Verifica' },
  { id: 'sec-riepilogo', label: 'Riepilogo' }
];

function scrollToSection(id) {
  document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
}

// ========== SCROLL OBSERVER ==========
const mainWrapper = document.getElementById('mainWrapper');

// Section reveal
const revealObserver = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      const delay = parseInt(e.target.dataset.delay || '0');
      setTimeout(() => e.target.classList.add('visible'), delay);
    }
  });
}, { threshold: 0.15, root: mainWrapper });

document.querySelectorAll('.section-reveal').forEach(el => revealObserver.observe(el));

// ========== DERIVATION STEPS ==========
let currentDerivStep = 0;
const derivSteps = document.querySelectorAll('#derivationSteps .step-item');
// Show first step
if (derivSteps[0]) derivSteps[0].classList.add('show');

function revealNextStep() {
  currentDerivStep++;
  if (currentDerivStep < derivSteps.length) {
    derivSteps[currentDerivStep].classList.add('show');
  }
  if (currentDerivStep >= derivSteps.length - 1) {
    document.getElementById('revealStepsBtn').textContent = 'âœ… Tutti i passi mostrati';
    document.getElementById('revealStepsBtn').disabled = true;
    document.getElementById('revealStepsBtn').style.opacity = '0.5';
  }
}

// ========== INTERACTIVE CANVAS ==========
const canvas = document.getElementById('interactiveCanvas');
const ctx = canvas.getContext('2d');

function updateCircle() {
  const a = parseFloat(document.getElementById('sliderA').value);
  const b = parseFloat(document.getElementById('sliderB').value);
  const r = parseFloat(document.getElementById('sliderR').value);

  document.getElementById('valA').textContent = a;
  document.getElementById('valB').textContent = b;
  document.getElementById('valR').textContent = r;

  // Equation display
  const aStr = a === 0 ? 'x' : (a > 0 ? `(x âˆ’ ${a})` : `(x + ${Math.abs(a)})`);
  const bStr = b === 0 ? 'y' : (b > 0 ? `(y âˆ’ ${b})` : `(y + ${Math.abs(b)})`);
  document.getElementById('currentEquation').textContent = `${aStr}Â² + ${bStr}Â² = ${(r*r).toFixed(r*r % 1 === 0 ? 0 : 2)}`;

  // Expanded form
  const alpha = -2 * a;
  const beta = -2 * b;
  const gamma = a * a + b * b - r * r;
  let expanded = 'xÂ² + yÂ²';
  if (alpha !== 0) expanded += (alpha > 0 ? ` + ${alpha}x` : ` âˆ’ ${Math.abs(alpha)}x`);
  if (beta !== 0) expanded += (beta > 0 ? ` + ${beta}y` : ` âˆ’ ${Math.abs(beta)}y`);
  if (gamma !== 0) expanded += (gamma > 0 ? ` + ${gamma.toFixed(gamma % 1 === 0 ? 0 : 2)}` : ` âˆ’ ${Math.abs(gamma).toFixed(Math.abs(gamma) % 1 === 0 ? 0 : 2)}`);
  expanded += ' = 0';
  document.getElementById('expandedEquation').textContent = expanded;

  drawCanvas(a, b, r);
}

function drawCanvas(a, b, r) {
  const w = canvas.width;
  const h = canvas.height;
  const colors = {
    bg: '#1e293b',
    text: '#e2e8f0',
    primary: '#f59e0b',
    secondary: '#6366f1'
  };

  ctx.clearRect(0, 0, w, h);

  // Background
  ctx.fillStyle = colors.bg;
  ctx.fillRect(0, 0, w, h);

  const scale = 40; // pixels per unit
  const cx = w / 2;
  const cy = h / 2;

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.06)';
  ctx.lineWidth = 1;
  for (let i = -6; i <= 6; i++) {
    ctx.beginPath();
    ctx.moveTo(cx + i * scale, 0);
    ctx.lineTo(cx + i * scale, h);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0, cy + i * scale);
    ctx.lineTo(w, cy + i * scale);
    ctx.stroke();
  }

  // Axes
  ctx.strokeStyle = 'rgba(255,255,255,0.3)';
  ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(w, cy); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, h); ctx.stroke();

  // Axis labels
  ctx.fillStyle = 'rgba(255,255,255,0.4)';
  ctx.font = '12px JetBrains Mono';
  ctx.textAlign = 'center';
  for (let i = -5; i <= 5; i++) {
    if (i === 0) continue;
    ctx.fillText(i.toString(), cx + i * scale, cy + 16);
    ctx.fillText((-i).toString(), cx - 12, cy + i * scale + 4);
  }
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  ctx.font = '14px JetBrains Mono';
  ctx.fillText('x', w - 15, cy - 8);
  ctx.fillText('y', cx + 12, 18);

  // Circle
  ctx.strokeStyle = colors.secondary;
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(cx + a * scale, cy - b * scale, r * scale, 0, Math.PI * 2);
  ctx.stroke();

  // Center point
  const centerX = cx + a * scale;
  const centerY = cy - b * scale;
  ctx.fillStyle = colors.primary;
  ctx.beginPath();
  ctx.arc(centerX, centerY, 6, 0, Math.PI * 2);
  ctx.fill();

  // Radius line
  ctx.strokeStyle = colors.primary;
  ctx.lineWidth = 1.5;
  ctx.setLineDash([4, 4]);
  ctx.beginPath();
  ctx.moveTo(centerX, centerY);
  ctx.lineTo(centerX + r * scale, centerY);
  ctx.stroke();
  ctx.setLineDash([]);

  // Radius label
  ctx.fillStyle = colors.primary;
  ctx.font = '13px JetBrains Mono';
  ctx.textAlign = 'center';
  ctx.fillText('r=' + r, centerX + r * scale / 2, centerY - 10);

  // Center label
  ctx.fillText(`C(${a}, ${b})`, centerX, centerY + 22);

  // Check point if visible
  const px = parseFloat(document.getElementById('checkX').value);
  const py = parseFloat(document.getElementById('checkY').value);
  if (!isNaN(px) && !isNaN(py)) {
    const ppx = cx + px * scale;
    const ppy = cy - py * scale;
    ctx.fillStyle = '#10b981';
    ctx.beginPath();
    ctx.arc(ppx, ppy, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.font = '11px JetBrains Mono';
    ctx.fillText(`P(${px},${py})`, ppx, ppy - 10);
  }
}

// Click on canvas to set center
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  const mx = (e.clientX - rect.left) * scaleX;
  const my = (e.clientY - rect.top) * scaleY;

  const scale = 40;
  const a = Math.round(((mx - canvas.width / 2) / scale) * 2) / 2;
  const b = Math.round((-(my - canvas.height / 2) / scale) * 2) / 2;

  const clampA = Math.max(-5, Math.min(5, a));
  const clampB = Math.max(-5, Math.min(5, b));

  document.getElementById('sliderA').value = clampA;
  document.getElementById('sliderB').value = clampB;
  updateCircle();
});

function checkPoint() {
  const a = parseFloat(document.getElementById('sliderA').value);
  const b = parseFloat(document.getElementById('sliderB').value);
  const r = parseFloat(document.getElementById('sliderR').value);
  const px = parseFloat(document.getElementById('checkX').value);
  const py = parseFloat(document.getElementById('checkY').value);

  if (isNaN(px) || isNaN(py)) {
    document.getElementById('pointResult').innerHTML = '<span style="color:#ef4444">Inserisci valori validi.</span>';
    return;
  }

  const dist2 = (px - a) ** 2 + (py - b) ** 2;
  const r2 = r ** 2;
  const diff = Math.abs(dist2 - r2);

  let result;
  if (diff < 0.01) {
    result = `<span style="color:#10b981">âœ… SÃŒ! (${px}âˆ’${a})Â² + (${py}âˆ’${b})Â² = ${dist2.toFixed(2)} = ${r2.toFixed(2)} = rÂ²</span>`;
  } else if (dist2 < r2) {
    result = `<span style="color:#ef4444">âŒ NO, il punto Ã¨ INTERNO. DistanzaÂ² = ${dist2.toFixed(2)} < ${r2.toFixed(2)} = rÂ²</span>`;
  } else {
    result = `<span style="color:#ef4444">âŒ NO, il punto Ã¨ ESTERNO. DistanzaÂ² = ${dist2.toFixed(2)} > ${r2.toFixed(2)} = rÂ²</span>`;
  }

  document.getElementById('pointResult').innerHTML = result;
  updateCircle();
}

// ========== INTERACTIVE TABS ==========
function switchInteractiveTab(tab) {
  document.getElementById('tab-graph').classList.add('hidden');
  document.getElementById('tab-quiz-mini').classList.add('hidden');
  document.getElementById('tab-' + tab).classList.remove('hidden');

  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');

  if (tab === 'quiz-mini') initMiniQuiz();
}

// ========== MINI QUIZ ==========
const miniQuizData = [
  {
    q: "Qual Ã¨ il centro della circonferenza (xâˆ’3)Â² + (y+1)Â² = 16?",
    opts: ["C(3, 1)", "C(3, âˆ’1)", "C(âˆ’3, 1)", "C(âˆ’3, âˆ’1)"],
    correct: 1
  },
  {
    q: "Qual Ã¨ il raggio della circonferenza xÂ² + yÂ² = 49?",
    opts: ["r = 49", "r = -7", "r = 24.5", "r = <math><msqrt><mn>49</mn></msqrt></math> = 7"],
    correct: 3
  },
  {
    q: "Il punto (0, 5) appartiene alla circonferenza xÂ² + yÂ² = 25?",
    opts: ["SÃ¬", "No", "Solo se r > 5", "Non si puÃ² determinare"],
    correct: 0
  }
];

function initMiniQuiz() {
  const container = document.getElementById('miniQuizContainer');
  if (container.children.length > 0) return; // Already initialized

  miniQuizData.forEach((q, qi) => {
    const div = document.createElement('div');
    div.className = 'formula-box text-left';
    div.innerHTML = `
      <p class="font-bold mb-4">${qi + 1}. ${q.q}</p>
      <div class="space-y-2" id="mini-q-${qi}">
        ${q.opts.map((o, oi) => `
          <div class="quiz-option" data-qi="${qi}" data-oi="${oi}" onclick="answerMiniQuiz(${qi}, ${oi}, this)">
            <span class="mono mr-2">${String.fromCharCode(65 + oi)})</span> ${o}
          </div>
        `).join('')}
      </div>
      <p id="mini-fb-${qi}" class="mt-3 text-sm font-semibold"></p>
    `;
    container.appendChild(div);
  });
}

function answerMiniQuiz(qi, oi, el) {
  const container = document.getElementById(`mini-q-${qi}`);
  const options = container.querySelectorAll('.quiz-option');
  options.forEach(o => {
    o.classList.add('disabled');
    const oIdx = parseInt(o.dataset.oi);
    if (oIdx === miniQuizData[qi].correct) o.classList.add('correct');
    else if (oIdx === oi) o.classList.add('wrong');
  });

  const fb = document.getElementById(`mini-fb-${qi}`);
  if (oi === miniQuizData[qi].correct) {
    fb.innerHTML = '<span style="color:#10b981">âœ… Corretto!</span>';
  } else {
    fb.innerHTML = `<span style="color:#ef4444">âŒ La risposta corretta Ã¨ ${String.fromCharCode(65 + miniQuizData[qi].correct)}.</span>`;
  }
}

// ========== GUIDED PROBLEMS ==========
const problemSteps = {
  1: [
    { title: 'Passo 2: Sostituiamo i valori', content: '(x âˆ’ 2)Â² + (y âˆ’ (âˆ’3))Â² = 5Â²' },
    { title: 'Passo 3: Semplifichiamo', content: '(x âˆ’ 2)Â² + (y + 3)Â² = 25' },
    { title: 'âœ… Risultato finale', content: 'L\'equazione Ã¨: (x âˆ’ 2)Â² + (y + 3)Â² = 25' }
  ],
  2: [
    { title: 'Passo 2: Calcoliamo il centro', content: 'a = âˆ’Î±/2 = âˆ’(âˆ’6)/2 = 3\nb = âˆ’Î²/2 = âˆ’4/2 = âˆ’2\nâ†’ C(3, âˆ’2)' },
    { title: 'Passo 3: Calcoliamo il raggio', content: 'r = <math><msqrt><mn>Î±Â²/4 + Î²Â²/4 âˆ’ Î³</mn></msqrt></math> = <math><msqrt><mn>9 + 4 + 12</mn></msqrt></math> = <math><msqrt><mn>25</mn></msqrt></math> = 5' },
    { title: 'âœ… Risultato finale', content: 'Centro C(3, âˆ’2), Raggio r = 5' }
  ],
  3: [
    { title: 'Passo 2: Confrontiamo con il secondo membro', content: '5 = 5 âœ“\nIl risultato Ã¨ uguale!' },
    { title: 'âœ… Risultato finale', content: 'SÃŒ, P(1, 2) appartiene alla circonferenza perchÃ© soddisfa l\'equazione.' }
  ]
};
const problemCurrentStep = { 1: 0, 2: 0, 3: 0 };

function revealProblem(num) {
  const idx = problemCurrentStep[num];
  const steps = problemSteps[num];
  if (idx >= steps.length) return;

  const container = document.getElementById(`prob${num}Steps`);
  const step = steps[idx];
  const div = document.createElement('div');
  div.className = 'p-3 rounded-lg';
  div.style.background = 'rgba(99,102,241,0.1)';
  div.style.animation = 'fadeIn 0.4s ease';
  div.innerHTML = `
    <p class="font-semibold mb-1" style="color:var(--secondary-color)">${step.title}</p>
    <p class="mono whitespace-pre-line">${step.content}</p>
  `;
  container.appendChild(div);

  problemCurrentStep[num]++;
  if (problemCurrentStep[num] >= steps.length) {
    const btn = document.getElementById(`prob${num}Btn`);
    btn.textContent = 'âœ… Problema completato';
    btn.disabled = true;
    btn.style.opacity = '0.5';
  }
}

// ========== FINAL QUIZ ==========
const finalQuizData = [
  {
    type: 'mc',
    q: "1. L'equazione (x âˆ’ 1)Â² + (y + 2)Â² = 9 rappresenta una circonferenza con:",
    opts: ["Centro (1, âˆ’2), raggio 3", "Centro (âˆ’1, 2), raggio 9", "Centro (1, âˆ’2), raggio 9", "Centro (âˆ’1, 2), raggio 3"],
    correct: 0
  },
  {
    type: 'mc',
    q: "2. L'equazione xÂ² + yÂ² = 0 rappresenta:",
    opts: ["Una circonferenza di raggio 0 (un punto)", "Nessuna curva", "Una retta", "Un cerchio unitario"],
    correct: 0
  },
  {
    type: 'mc',
    q: "3. Data xÂ² + yÂ² + 2x âˆ’ 4y âˆ’ 4 = 0, qual Ã¨ il centro?",
    opts: ["C(2, âˆ’4)", "C(1, âˆ’2)", "C(âˆ’1, 2)", "C(âˆ’2, 4)"],
    correct: 2
  },
  {
    type: 'mc',
    q: "4. Il raggio della circonferenza xÂ² + yÂ² âˆ’ 10x + 6y + 18 = 0 Ã¨:",
    opts: ["r = 4", "r = <math><msqrt><mn>18</mn></msqrt></math>", "r = 16", "r = 2<math><msqrt><mn>7</mn></msqrt></math>"],
    correct: 0
  },
  {
    type: 'mc',
    q: "5. Il punto P(3, 4) appartiene alla circonferenza xÂ² + yÂ² = 25?",
    opts: ["SÃ¬, perchÃ© 9 + 16 = 25", "No, perchÃ© 9 + 16 â‰  25", "Solo se r = 5", "Non si puÃ² determinare"],
    correct: 0
  },
  {
    type: 'calc',
    q: "6. ESERCIZIO DI CALCOLO: Scrivi il raggio della circonferenza con equazione (x âˆ’ 4)Â² + (y + 1)Â² = 36.",
    answer: '6',
    hint: 'r = <math><msqrt><mn>36</mn></msqrt></math> = ?'
  },
  {
    type: 'calc',
    q: "7. ESERCIZIO DI CALCOLO: Data la circonferenza xÂ² + yÂ² âˆ’ 8x + 2y + 8 = 0, calcola il raggio.",
    answer: '3',
    hint: 'Centro: C(4, âˆ’1), poi r = <math><msqrt><mn>16 + 1 âˆ’ 8</mn></msqrt></math> = <math><msqrt><mn>9</mn></msqrt></math> = ?'
  }
];

const finalQuizAnswers = {};

function renderFinalQuiz() {
  const container = document.getElementById('finalQuiz');
  finalQuizData.forEach((q, qi) => {
    const div = document.createElement('div');
    div.className = 'formula-box text-left';
    div.id = `fq-${qi}`;

    if (q.type === 'mc') {
      div.innerHTML = `
        <p class="font-bold mb-4">${q.q}</p>
        <div class="space-y-2" id="fq-opts-${qi}">
          ${q.opts.map((o, oi) => `
            <div class="quiz-option" data-qi="${qi}" data-oi="${oi}" onclick="selectFinalAnswer(${qi}, ${oi}, this)">
              <span class="mono mr-2">${String.fromCharCode(65 + oi)})</span> ${o}
            </div>
          `).join('')}
        </div>
        <p id="fq-fb-${qi}" class="mt-3 text-sm font-semibold"></p>
      `;
    } else {
      div.innerHTML = `
        <p class="font-bold mb-2">${q.q}</p>
        <p class="text-sm opacity-50 mb-3">ğŸ’¡ Suggerimento: ${q.hint}</p>
        <div class="flex gap-3 items-end">
          <div>
            <label for="fq-input-${qi}" class="text-sm opacity-60">Risposta:</label>
            <input type="number" id="fq-input-${qi}" class="mono w-24 px-3 py-2 rounded-lg border-none text-center" style="background:rgba(255,255,255,0.1); color:var(--text-color);" oninput="finalQuizAnswers[${qi}] = this.value">
          </div>
        </div>
        <p id="fq-fb-${qi}" class="mt-3 text-sm font-semibold"></p>
      `;
    }
    container.appendChild(div);
  });
}

function selectFinalAnswer(qi, oi, el) {
  // Toggle selection
  const container = document.getElementById(`fq-opts-${qi}`);
  container.querySelectorAll('.quiz-option').forEach(o => {
    o.style.borderColor = 'rgba(255,255,255,0.1)';
    o.style.background = 'var(--surface-color)';
  });
  el.style.borderColor = 'var(--secondary-color)';
  el.style.background = 'rgba(99,102,241,0.15)';
  finalQuizAnswers[qi] = oi;
}

function submitFinalQuiz() {
  let score = 0;
  let total = finalQuizData.length;

  finalQuizData.forEach((q, qi) => {
    const fb = document.getElementById(`fq-fb-${qi}`);

    if (q.type === 'mc') {
      const container = document.getElementById(`fq-opts-${qi}`);
      const options = container.querySelectorAll('.quiz-option');
      const userAnswer = finalQuizAnswers[qi];

      options.forEach(o => {
        o.classList.add('disabled');
        const oIdx = parseInt(o.dataset.oi);
        if (oIdx === q.correct) o.classList.add('correct');
        else if (oIdx === userAnswer) o.classList.add('wrong');
      });

      if (userAnswer === q.correct) {
        score++;
        fb.innerHTML = '<span style="color:#10b981">âœ… Corretto!</span>';
      } else if (userAnswer !== undefined) {
        fb.innerHTML = `<span style="color:#ef4444">âŒ La risposta corretta Ã¨ ${String.fromCharCode(65 + q.correct)}.</span>`;
      } else {
        fb.innerHTML = '<span style="color:#ef4444">âš ï¸ Non hai risposto.</span>';
      }
    } else {
      const input = document.getElementById(`fq-input-${qi}`);
      const userVal = input ? input.value.trim() : '';
      input.disabled = true;

      if (userVal === q.answer) {
        score++;
        fb.innerHTML = `<span style="color:#10b981">âœ… Corretto! La risposta Ã¨ ${q.answer}.</span>`;
      } else if (userVal) {
        fb.innerHTML = `<span style="color:#ef4444">âŒ La risposta corretta Ã¨ ${q.answer}.</span>`;
      } else {
        fb.innerHTML = `<span style="color:#ef4444">âš ï¸ Non hai risposto. La risposta Ã¨ ${q.answer}.</span>`;
      }
    }
  });

  const resultDiv = document.getElementById('quizResult');
  resultDiv.classList.remove('hidden');
  const pct = Math.round((score / total) * 100);

  if (pct >= 80) {
    resultDiv.innerHTML = `<span style="color:#10b981">ğŸ‰ Eccellente! ${score}/${total} (${pct}%)</span>`;
  } else if (pct >= 60) {
    resultDiv.innerHTML = `<span style="color:var(--primary-color)">ğŸ‘ Buono! ${score}/${total} (${pct}%). Ripassa le sezioni precedenti.</span>`;
  } else {
    resultDiv.innerHTML = `<span style="color:#ef4444">ğŸ“š ${score}/${total} (${pct}%). Rileggi la lezione e riprova!</span>`;
  }

  document.getElementById('submitQuizBtn').textContent = 'ğŸ”„ Quiz completato';
  document.getElementById('submitQuizBtn').disabled = true;
  document.getElementById('submitQuizBtn').style.opacity = '0.5';
}

// ========== INIT ==========
// Add fadeIn keyframe
const style = document.createElement('style');
style.textContent = '@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }';
document.head.appendChild(style);

updateCircle();
renderFinalQuiz();

// ========== TOUCH + RESPONSIVE CANVAS ==========
(function() {
  var cvs = document.getElementById('interactiveCanvas');
  if (!cvs) return;

  function getCoordsFromEvent(e) {
    var rect = cvs.getBoundingClientRect();
    var sx = cvs.width / rect.width;
    var sy = cvs.height / rect.height;
    var src = e.touches ? e.touches[0] : e;
    return {
      mx: (src.clientX - rect.left) * sx,
      my: (src.clientY - rect.top) * sy
    };
  }

  function applyCoords(mx, my) {
    var scale = 40;
    var a = Math.round(((mx - cvs.width / 2) / scale) * 2) / 2;
    var b = Math.round((-(my - cvs.height / 2) / scale) * 2) / 2;
    document.getElementById('sliderA').value = Math.max(-5, Math.min(5, a));
    document.getElementById('sliderB').value = Math.max(-5, Math.min(5, b));
    updateCircle();
  }

  cvs.addEventListener('touchstart', function(e) {
    e.preventDefault();
    var c = getCoordsFromEvent(e);
    applyCoords(c.mx, c.my);
  }, { passive: false });

  function resizeCanvas() {
    var parent = cvs.parentElement;
    if (!parent) return;
    var w = Math.min(parent.clientWidth, 500);
    if (w > 50 && cvs.width !== w) {
      cvs.width = w;
      cvs.height = w;
      updateCircle();
    }
  }
  window.addEventListener('resize', resizeCanvas);
  // run after paint so layout is settled
  requestAnimationFrame(function() { setTimeout(resizeCanvas, 50); });
})();
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd418a877524c43',t:'MTc3MDk4MzMwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
